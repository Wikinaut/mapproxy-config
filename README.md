mapproxy-config
===============

Avaliable URLs and OpenStreetMap-Editing-URL
-------

| Name | Status/N√ºtzlichkeit | Example Usage: User Layer to Edit OpenStreetMap (OSM) | URL |
|---|---|---|---|
| Berlin 1928 | ‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/1928/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/1928/mercator/{z}/{x}/{y}.png` |
| Berlin 1953 | ‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/1953/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/1953/mercator/{z}/{x}/{y}.png` |
| Digitale farbige Orthophotos 2013 (DOP20RGB) | ‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2013/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/2013/mercator/{z}/{x}/{y}.png` |
| Digitale Color-Infrarot-Orthophotos 2015 (DOP20CIR) | ‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2015_cir/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/2015_cir/mercator/{z}/{x}/{y}.png` |
| Digitale Color-Infrarot-Orthophotos 2016 (DOP20CIR) | ‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2016_cir/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/2016_cir/mercator/{z}/{x}/{y}.png` |
| Digitale farbige Orthophotos 2018 (DOP20RGB) | ‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2018/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/2018/mercator/{z}/{x}/{y}.png` |
| Digitale farbige Orthophotos 2019 (DOP20RGB) | ‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2019/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/2019/mercator/{z}/{x}/{y}.png` |
| Digitale Color-Infrarot-Orthophotos 2016 (DOP20CIR) | ? | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2020_true/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/2020_true/mercator/{z}/{x}/{y}.png` |
| Digitale farbige Orthophotos 2020 (DOP20RGB) | üü©/üü° <!-- Verschwommen --> | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2020/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/2020/mercator/{z}/{x}/{y}.png` |
| Digitale farbige Orthophotos 2021 (DOP20RGB) | üü©/üü¢ | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/2021/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/2021/mercator/{z}/{x}/{y}.png` |
| ALKIS Berlin (Amtliches Liegenschaftskatasterinformationssystem) | üü• 500/‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/alkis_30/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/alkis_30/mercator/{z}/{x}/{y}.png` |
| ATKIS(R) DOM - Digitales Oberfl√§chenmodell | üü©/üü° <!-- Sehr pixelig/grob. Zeigt aber B√§ume/H√§user gut. --> | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/atkis_dom/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/atkis_dom/mercator/{z}/{x}/{y}.png` |
| ATKIS(R) DGM - Digitales Gel√§ndemodell | üü©/üî¥ <!-- Viel zu grob aufgel√∂√üt --> | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/atkis_dgm_1/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/atkis_dgm_1/mercator/{z}/{x}/{y}.png` |
| ATKIS(R) DGM - Digitales Gel√§ndemodell | üü©/‚ùîüü° <!-- Hintergrund m√ºsste wei√ü; Zeigt nur Hausnummern? --> | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/atkis_dgm_3/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/atkis_dgm_3/mercator/{z}/{x}/{y}.png` |
| Stra√üenbefahrung 2014 | üü• 500/‚ùî | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/strassenbefahrung/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/strassenbefahrung/mercator/{z}/{x}/{y}.png` |
| TopPlusOpen | üü©/üî¥ <!-- Andere Daten pr√§ziser. --> | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/topplus_p5/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/topplus_p5/mercator/{z}/{x}/{y}.png` |
| TopPlusOpen web | üü©/üî¥ <!-- Andere Daten pr√§ziser; eigenartige Punktlinien --> | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/topplus_web/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/topplus_web/mercator/{z}/{x}/{y}.png` |
| WebAtlas Berlin | üü©/üü° <!-- Andere Daten pr√§ziser; zeigt Hausnummern. --> | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/webatlas/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/webatlas/mercator/{z}/{x}/{y}.png` |
| Berlin Zoom | üü©/üü¢ | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/zoom/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/zoom/mercator/{z}/{x}/{y}.png` |
| Baumbestand Berlin - Stra√üenb√§ume | üü©/üü¢ | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_0/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_0/mercator/{z}/{x}/{y}.png` |
| Baumbestand Berlin - Anlagenb√§ume | üü©/üü¢ | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_1/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_1/mercator/{z}/{x}/{y}.png` |
| Baumbestand Berlin - Anlagenb√§ume ohne Datenbankeintrag | üü©/üü° <!-- Kaum Daten -->  | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_3/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_3/mercator/{z}/{x}/{y}.png` |
| Baumbestand Berlin - Stra√üenb√§ume ohne Datenbankeintrag | üü©/üü° <!-- Kaum Daten --> | [Use to edit OSM](https://www.openstreetmap.org/edit?editor=id#background=custom:https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_4/mercator/{z}/{x}/{y}.png&disable_features=boundaries&map=20.00/52.47241/13.44637) | `https://mapproxy.codefor.de/tiles/1.0.0/baumbestand_4/mercator/{z}/{x}/{y}.png` |


Install
-------

```
python3 -m venv env
source env/bin/activate
pip install -r requirements.txt
```

Run local
---------

```
mapproxy-util serve-develop config.yml
```

Deployment
----------

```
# creates the wsgi.py script
mapproxy-util create -t wsgi-app -f config.yml wsgi.py
```

Note: We don't use `make_wsgi_app(‚Ä¶, reloader=True)` but restart the server manually. The auto reloading would only restart if the config is valid, which would hide a broken edit. The manual reload will make the error visible.

Create a systemd service script in `/etc/systemd/system/mapproxy.service`.

```
[Unit]
Description=Mapproxy gunicorn daemon
After=network.target

[Service]
User=tiles
Group=tiles
WorkingDirectory=/srv/tiles/proxy
ExecStart=/srv/tiles/proxy/env/bin/gunicorn --access-logfile /var/log/mapproxy/access.log --error-logfile /var/log/mapproxy/error.log --bind unix:/tmp/mapproxy.sock --workers 9 wsgi:application

[Install]
WantedBy=multi-user.target
```

```bash
systemctl daemon-reload
systemctl start mapproxy
```

Add to nginx configuration:

```
    location /proxy/ {
        proxy_pass http://unix:/tmp/mapproxy.sock;
        proxy_set_header Host $http_host;
        proxy_set_header X-Script-Name /proxy;
    }
```

```bash
nginx -t
systemctl start nginx
```


Useful WMS query params
-----------------------

```
?service=WMS&request=GetCapabilities&version=1.1.1

?format=image%2Fpng&height=512&bbox=388800.010065,5818137.195276,393794.488433,5821374.047744&layers=0&srs=ESPG:25833&style=default&service=WMS&request=GetMap&width=512&version=1.1.1

?width=512&height=512&bbox=388800,5818137,393794,5821374&layers=0&srs=EPSG:4326&styles=default&format=image/png&service=WMS&request=GetMap&version=1.1.1
```
